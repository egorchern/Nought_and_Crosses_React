"use strict";var __extends=this&&this.__extends||function(){var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();exports.__esModule=!0;var React=require("react"),react_dom_1=require("react-dom"),root=document.querySelector("#root");function copy_array(e){for(var t=[],r=0;r<e.length;r+=1){var a=typeof e[r],n=e[r];"object"==a&&(n=copy_array(n)),t.push(n)}return t}function generate_n_size_array(e,t){for(var r=[],a=0;a<e;a+=1){for(var n=[],o=0;o<e;o+=1)n.push(t);r.push(n)}return r}function check_game_state(e){for(var t=!0,r=e.length,a=e[0].length,n=generate_n_size_array(a,""),o=0;o<r;o+=1){for(var s=e[o],i=0,c=0,l=0;l<s.length;l+=1)n[l][o]=s[l],"X"===s[l]?i+=1:"O"===s[l]&&(c+=1);if(i===r)return"X";if(c===r)return"O"}for(var _=0;_<a;_+=1){for(var u=n[_],i=0,c=0,l=0;l<u.length;l+=1)"X"===u[l]?i+=1:"O"===u[l]?c+=1:t=!1;if(i===a)return"X";if(c===a)return"O"}for(var m=[],p=[],h=0;h<r;h+=1)p.push(e[h][h]);for(var d=[],y=0,f=a-1;y<r;y+=1)d.push(e[y][f]),--f;m.push(p),m.push(d);for(var v=0;v<2;v+=1){for(var b=m[v],i=0,c=0,l=0;l<b.length;l+=1)"X"===b[l]?i+=1:"O"===b[l]&&(c+=1);if(i===r)return"X";if(c===r)return"O"}return!0===t?"D":""}function get_possible_moves(e){for(var t=e.length,r=[],a=0;a<t;a+=1)for(var n,o=0;o<t;o+=1){""===e[a][o]&&(n=[a,o],r.push(n))}return r}function make_move_on_board(e,t,r){var a=copy_array(e);return a[t[0]][t[1]]=r,a}function minmax(e,t,r,a,n){switch(check_game_state(e)){case"X":return"X"===r?[1,n]:[-1,n];case"O":return"O"===r?[1,n]:[-1,n];case"D":return[0,n]}if(!0===t){for(var o=1/0,s=1/0,i=get_possible_moves(e),c=0;c<i.length;c+=1){var l=(m=minmax(make_move_on_board(e,i[c],a),!1,r,a,n+1))[0],_=m[1];l<o?(o=l,s=_):l===o&&_<s&&(s=_)}return[o,s]}for(var u=-1/0,s=1/0,i=get_possible_moves(e),c=0;c<i.length;c+=1){var m,l=(m=minmax(make_move_on_board(e,i[c],r),!0,r,a,n+1))[0],_=m[1];u<l?(u=l,s=_):l===u&&_<s&&(s=_)}return[u,s]}function select_best_move(e,t,r){for(var a,n=-1/0,o=1/0,s=get_possible_moves(e),i=0;i<s.length;i+=1){var c=s[i],l=minmax(make_move_on_board(e,c,t),!0,t,r,0),_=l[0],u=l[1];console.log(_,u),n<_?(n=_,a=c,o=u):_===n&&u<o&&(o=u,a=c)}return console.log("\n"),a}var Field_square=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.render=function(){var e=this.props.value;return!0===this.props.is_disabled?React.createElement("div",{className:"square_container disabled"},e):React.createElement("div",{className:"square_container",onClick:this.props.onClick},e)},e}(React.Component),Field=function(t){function e(e){var n=t.call(this,e)||this;return n.handle_click=function(e,t){var r,a=n.state.board;a[e][t]=n.turn,n.setState({board:a}),"X"===n.turn?n.turn="O":n.turn="X",n.game_state=check_game_state(a),""===n.game_state&&n.ai_symbol===n.turn&&(r=select_best_move(n.state.board,n.ai_symbol,n.player_symbol),n.handle_click(r[0],r[1]))},n.handle_key_down=function(e){var t;"r"===e.key&&(n.turn="X",n.player_symbol=n.props.player_symbol,n.ai_symbol=n.props.ai_symbol,n.game_state="",n.setState({board:generate_n_size_array(n.props.size,"")}),"X"===n.ai_symbol&&(t=select_best_move(n.state.board,n.ai_symbol,n.player_symbol),n.handle_click(t[0],t[1])))},n.state={board:generate_n_size_array(n.props.size,"")},n.turn="X",n.player_symbol=n.props.player_symbol,n.ai_symbol=n.props.ai_symbol,n.game_state="",n}return __extends(e,t),e.prototype.componentDidMount=function(){var e;window.onkeydown=this.handle_key_down,"X"===this.ai_symbol&&(e=select_best_move(this.state.board,this.ai_symbol,this.player_symbol),this.handle_click(e[0],e[1]))},e.prototype.render=function(){var o=this,e=this.state.board.map(function(e,t){var n=t;return React.createElement("div",{key:n,className:"field_row"},e.map(function(e,t){var r=t,a=""!=e||""!=o.game_state;return React.createElement(Field_square,{key:r,value:e,is_disabled:a,onClick:function(){return o.handle_click(n,r)}})}))}),t="Next turn: "+this.turn;return""!=this.game_state&&(t=this.game_state+" won!"),"D"===this.game_state&&(t="Draw!"),React.createElement("div",{className:"field_container"},React.createElement("h2",null,t),""!=this.game_state&&React.createElement("h2",null,"Press R to restart"),e)},e}(React.Component),Menu=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.render=function(){var e=this;return React.createElement("div",null,React.createElement("div",null,React.createElement("span",{id:"choose_menu_heading"},"Choose what symbol you play as")),React.createElement("div",{className:"menu"},React.createElement("div",{onClick:function(){return e.props.onClick("X")},className:"choose_menu_button"},React.createElement("span",null,"X")),React.createElement("div",{onClick:function(){return e.props.onClick("O")},className:"choose_menu_button"},React.createElement("span",null,"O"))))},e}(React.Component),App=function(r){function e(e){var t=r.call(this,e)||this;return t.handle_symbol_choose_click=function(e){t.player_symbol=e,t.ai_symbol="X"===e?"O":"X",t.setState({menu_enabled:!1})},t.state={menu_enabled:!0},t.player_symbol,t.ai_symbol,t.field_size=3,t}return __extends(e,r),e.prototype.render=function(){var e=this.state.menu_enabled;return React.createElement("div",{className:"app_container"},!0===e&&React.createElement(Menu,{onClick:this.handle_symbol_choose_click}),!1===e&&React.createElement("div",{className:"game_container"},React.createElement(Field,{size:this.field_size,player_symbol:this.player_symbol,ai_symbol:this.ai_symbol})))},e}(React.Component);react_dom_1.render(React.createElement(App,null),root);